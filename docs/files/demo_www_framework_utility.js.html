<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>demo/www/framework/utility.js - YASMF</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="YASMF"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.3.100</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/PKObject.html">PKObject</a></li>
            
                <li><a href="../classes/UI.html">UI</a></li>
            
                <li><a href="../classes/UI.COLOR.html">UI.COLOR</a></li>
            
                <li><a href="../classes/UI.FONT.html">UI.FONT</a></li>
            
                <li><a href="../classes/UI.Label.html">UI.Label</a></li>
            
                <li><a href="../classes/UI.SHADOW.html">UI.SHADOW</a></li>
            
                <li><a href="../classes/UI.View.html">UI.View</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/PKObject.html">PKObject</a></li>
            
                <li><a href="../modules/UI.html">UI</a></li>
            
                <li><a href="../modules/UI.Label.html">UI.Label</a></li>
            
                <li><a href="../modules/UI.View.html">UI.View</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: demo/www/framework/utility.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/******************************************************************************
 *
 * UTILITY
 * Author: Kerri Shotts
 *
 * This library includes simple utility functions
 *
 ******************************************************************************/
/*jshint
         asi:true,
         bitwise:true,
         browser:true,
         camelcase:true,
         curly:true,
         eqeqeq:false,
         forin:true,
         noarg:true,
         noempty:true,
         plusplus:false,
         smarttabs:true,
         sub:true,
         trailing:false,
         undef:true,
         white:false,
         onevar:false 
 */
/*global PKLOC, device, cordova, console */
/*requires: cordova.js*/
var PKUTIL = PKUTIL ||
{
};
// create the namespace
PKUTIL.version = { major: 0, minor: 3, rev: 100 };

//
// Properties
//
PKUTIL.consoleLogging = false; // add console logging flag, v0.3.100
PKUTIL.COMPLETION_SUCCESS = true;
PKUTIL.COMPLETION_FAILURE = false;

//
// Methods
//

/**
 *
 * Checks to see if the dependency has already been loaded.
 *
 */
PKUTIL._dependencies = [];
PKUTIL.export = function ( dependency )
{
  if (dependency.push)
  {
    // probably an array; use it as such
    for (var i=0; i&lt;dependency.length; i++)
    {
      PKUTIL._dependencies.push ( dependency[i] );
    }
  }
  else
  {
    PKUTIL._dependencies.push ( dependency );
  }
}
PKUTIL.require = function ( dependency, completion )
{
  if (!dependency)
  {
    return true;
  }
  var allRequires;
  if (dependency.push)
  {
    allRequires = dependency;
  }
  else
  {
    allRequires = [ dependency ];
  }
  var allDepenciesMet = true;
  for (var i=0; i&lt;allRequires.length; i++)
  {
    var dependencyMet = PKUTIL._dependencies.indexOf ( allRequires[i] ) &gt; -1;
    if (!dependencyMet)
    {
      if (PKUTIL.consoleLogging) { console.log (&quot;[WARN] Dependency &quot; + allRequires[i] + &quot; not met.&quot;); }
      throw &quot;Dependency Failure&quot;;
    }
    allDepenciesMet = allDepenciesMet &amp;&amp; dependencyMet; 
  }
  if (allDepenciesMet)
  {
    if (completion)
    {
      completion();
    }
  }
  return allDepenciesMet;
}
PKUTIL.export ( &quot;PKUTIL&quot; );
PKUTIL.require ( null );

/**
 *
 * Returns an element specified by elementId. Similar to (but not exactly like) jQuery&#x27;s $()
 *
 */
function $ge(elementId)
{
  return document.getElementById(elementId);
}

/**
 *
 * Returns an element specified by elementId, but with localization. Localization assumes
 * you have at least one element of the form &lt;elementId_enus&gt;, and that all other localized
 * elements have the locale after the elementId appended with an underscore.
 * (eg: thisElementIsLocalized_enus and thisElementIsLocalized_eses)
 */
function $geLocale(elementId)
{
  var currentLocale = PKLOC.getUserLocale();
  var theLocalizedElementId = elementId + &quot;_&quot; + currentLocale;
  if ($ge(theLocalizedElementId))
  {
    return $ge(theLocalizedElementId);
  }

  theLocalizedElementId = elementId + &quot;_&quot; + currentLocale.substr(0, 2);
  if ($ge(theLocalizedElementId))
  {
    return $ge(theLocalizedElementId);
  }

  theLocalizedElementId = elementId + &quot;_en-US&quot;;
  if ($ge(theLocalizedElementId))
  {
    return $ge(theLocalizedElementId);
  }

  theLocalizedElementId = elementId + &quot;_en&quot;;
  if ($ge(theLocalizedElementId))
  {
    return $ge(theLocalizedElementId);
  }

  return $ge(elementId);
  // we don&#x27;t have it; return the default element.
}

/**
 *
 * Similar to $$. Returns all classes matching a selector.
 *
 */
function $gac(selector)
{
  return Array.prototype.slice.call(document.querySelectorAll(selector));
}

/**
 *
 * Utility function to delay execution of code
 *
 */
PKUTIL.delay = function(theDelay, theFunction)
{
  return setTimeout(theFunction, theDelay);
}
/**
 *
 * Loads a file or URL and returns it to the completion
 * handler. The completion handler must be of the form
 * fn(success/failure, data).
 *
 * @param theFileName       the file or URL to load
 * @param aSync             if TRUE, load asynchronously
 * @param completion        completion block
 *
 */
PKUTIL.loadQueue = Array();
PKUTIL.XHRinProgress = false;
PKUTIL.XHRTimer = -1;

PKUTIL.load = function(theFileName, aSync, completion)
{
  // if we&#x27;re running on anything but Windows Phone, we call
  // _load directly, since it does the right thing.
  if (device.platform != &quot;WinCE&quot;)
  {
    PKUTIL._load(theFileName, aSync, completion);
    return;
  }

  // but if we re running on Windows Phone, we need to queue
  // the requests so that we can process them in order.
  if (PKUTIL.consoleLogging) { console.log(&quot;Pushing request to load XHR: &quot; + theFileName); }
  PKUTIL.loadQueue.push(function()
  {
    if (PKUTIL.consoleLogging) { console.log(&quot;Processing XHR &quot; + theFileName); }
    PKUTIL._load(theFileName, aSync, completion);
  });

  if (PKUTIL.XHRTimer &lt; 0)
  {
    PKUTIL.XHRTimer = setInterval(PKUTIL._XHRQueue, 100);
  }
}

PKUTIL._XHRQueue = function()
{
  if (PKUTIL.XHRinProgress)
  {
    return;
  }
  if (PKUTIL.loadQueue.length &gt; 0)
  {
    var f = PKUTIL.loadQueue.pop();
    f();
  }
}

PKUTIL._load = function(theFileName, aSync, completion)
{
  if (!window.XMLHttpRequest)
  {
    if (completion)
    {
      completion(PKUTIL.COMPLETION_FAILURE, &quot;This browser does not support XMLHttpRequest.&quot;);
      return;
    }
  }

  PKUTIL.XHRinProgress = true;

  var r = new XMLHttpRequest();
  r.onreadystatechange = function()
  {
    if (r.readyState == 4)// loaded
    {
      if (r.status == 200 || r.status === 0)// success
      {
        if (completion)
        {
          if (PKUTIL.consoleLogging) 
            { console.log(&quot;success loading &quot; + theFileName + &quot;, length &quot; + r.responseText.length); }
          completion(PKUTIL.COMPLETION_SUCCESS, r.responseText);
          PKUTIL.XHRinProgress = false;
        }
      } else// failed to load
      {
        if (completion)
        {
          completion(PKUTIL.COMPLETION_FAILURE, r.status);
          PKUTIL.XHRinProgress = false;
        }
      }
    }
  }
  if (device.platform == &quot;WinCE&quot; &amp;&amp; theFileName.substr(0, 4) != &quot;http&quot;)
  {
    r.open(&#x27;GET&#x27;, &quot;/app/www/&quot; + theFileName, true);
  } else
  {
    r.open(&#x27;GET&#x27;, theFileName, aSync);
  }
  r.send();

}
/**
 *
 * Javascript doesn&#x27;t provide any native include functionality,
 * which tends to bloat code and result in long scripts that are
 * brittle. Here&#x27;s our tiny effort to help stem the tide and
 * make Javascript just a /little/ nicer.
 *
 * NOTE: includes are loaded SYNCHRONOUSLY. This is done as further
 * includes may rely upon the one being loaded now. However, it does
 * mean that larger files may take longer to process.
 *
 */
PKUTIL.include = function(theScripts, completion)
{
  var theNewScripts = theScripts;
  if (theNewScripts.length === 0)
  {
    if (completion)
    {
      completion();
    }
    return;
  }
  var theScriptName = theNewScripts.pop();
  PKUTIL.load(theScriptName, true, function(success, data)
  {
    if (success)
    {
      var theScriptElement = document.createElement(&quot;script&quot;);
      theScriptElement.type = &quot;text/javascript&quot;;
      theScriptElement.charset = &quot;utf-8&quot;;
      theScriptElement.text = data;
      document.body.appendChild(theScriptElement);
      // add it as a script tag
    } else
    {
      if (PKUTIL.consoleLogging) 
        { console.log(&quot;WARNING: Failed to load &quot; + theScriptName); }
    }
    PKUTIL.include(theNewScripts, completion);
  });
}
/**
 *
 * Loads an HTML fragment, creates a DIV, and adds it to the DOM.
 * Any script tags inside will be executed.
 *
 * @param theFileName           the file or URL to laod
 * @param options               An array of options, as follows:
 *    @param aSync                 Determines if the file is loaded
 *                                 asynchronously or not.
 *    @param id                    The ID to attach to the DIV created
 *                                 to surround the content.
 *    @param className             The class name to attach to the DIV
 *                                 created to surround the content.
 *    @param attachTo              Indicates the element to append the
 *                                 content to. If not specified,
 *                                 document.body is used.
 * @param completion            A function called when loading is
 *                              complete. Of the form fn ( successOrFailure )
 *                              so that success or failure of the load
 *                              can be determined.
 *
 */
PKUTIL.loadHTML = function(theFileName, options, completion)
{
  var aSync = options[&quot;aSync&quot;];
  PKUTIL.load(theFileName, aSync, function(success, data)
  {
    if (success)
    {
      // extract our values out of the options array
      var theId = options[&quot;id&quot;];
      var theClass = options[&quot;className&quot;];
      var attachTo = options[&quot;attachTo&quot;];

      // create the DIV element that will contain the data
      var theElement = document.createElement(&quot;DIV&quot;);
      theElement.setAttribute(&quot;id&quot;, theId);
      theElement.setAttribute(&quot;class&quot;, theClass);

      // make sure the element isn&#x27;t visible, yet
      theElement.style.display = &quot;none&quot;;

      // add the data
      theElement.innerHTML = data;

      // add it to the DOM
      if (attachTo)
      {
        attachTo.appendChild(theElement);
      } else
      {
        document.body.appendChild(theElement);
      }

      // now, handle the scripts that might be in there
      var theScriptTags = theElement.getElementsByTagName(&quot;script&quot;);
      for (var i = 0; i &lt; theScriptTags.length; i++)
      {
        // try...catch to get an indication that the /script/ is what is
        // causing an error, not this block.
        try
        {
          // inspired by http://bytes.com/topic/javascript/answers/513633-innerhtml-script-tag
          var theScriptElement = document.createElement(&quot;script&quot;);
          theScriptElement.type = &quot;text/javascript&quot;;
          theScriptElement.charset = &quot;utf-8&quot;;
          if (theScriptTags[i].src)
          {
            theScriptElement.src = theScriptTags[i].src;
          } else
          {
            theScriptElement.text = theScriptTags[i].text;
          }
          document.body.appendChild(theScriptElement);
        } catch ( err )
        {
          if (PKUTIL.consoleLogging) { console.log(&quot;When loading &quot; + theFileName + &quot;, error: &quot; + err); }
        }
      }
      if (completion)
      {
        completion(PKUTIL.COMPLETION_SUCCESS);
      }
    } else
    {
      if (PKUTIL.consoleLogging) { console.log(&quot;WARNING: Failed to load &quot; + theFileName); }
      if (completion)
      {
        completion(PKUTIL.COMPLETION_FAILURE);
      }
    }
  });
}
/**
 *
 * Retrieves a JSON string from the specified URL, and executes completion.
 * Completion must be of the form ( success, data ).
 *
 * @param theURL     the URL or Filename
 * @param completion function of the from ( success, data )
 *
 */
PKUTIL.loadJSON = function(theURL, completion)
{
  PKUTIL.load(theURL, true, function(success, data)
  {
    var theParsedData =
    {
    };

    if (success)
    {
      try
      {
        theParsedData = JSON.parse(data);
      } catch (err)
      {
        if (PKUTIL.consoleLogging) { console.log(&quot;Failed to parse JSON from &quot; + theURL); }
        success = PKUTIL.COMPLETION_FAILURE;
      }
    }
    // call completion, if available
    if (completion)
    {
      completion(success, theParsedData);
    }
  });
}
/**
 *
 * Loads a URL in a popup window. Uses ChildBrowser for PG 2.2.x or
 * lower, and in-app browser for 2.3 or higher.
 *
 */
PKUTIL.showURL = function(theURL)
{
  if (device.cordova &lt; 2.3)
  {
    switch (device.platform)
    {
      case &quot;Android&quot;:
        window.plugins.childBrowser.showWebPage(theURL);
        break;
      case &quot;WinCE&quot;:
        var options =
        {
          url : theURL,
          geolocationEnabled : false
        };
        cordova.exec(null, null, &quot;ChildBrowserCommand&quot;, &quot;showWebPage&quot;, options);
        break;
      default:
        // iOS
        cordova.exec(&quot;ChildBrowserCommand.showWebPage&quot;, theURL);
    }
  }
  else
  {
    // use in-app browser instead
    window.open ( theURL, &#x27;_blank&#x27; );
  }
}
/**
 *
 * instanceOfTemplate returns an HTML string ready for insertion into the DOM
 * as an instance of the supplied template (templateElement). Any %VAR% are
 * replaced by VAR from the replacements object.
 *
 **/

PKUTIL.instanceOfTemplate = function(templateElement, replacements)
{
  var templateHTML = templateElement.innerHTML || templateElement;
  for (var theVar in replacements)
  {
    while (templateHTML.indexOf(&#x27;%&#x27; + theVar.toUpperCase() + &#x27;%&#x27;) &gt; -1)
    {
      templateHTML = templateHTML.replace(&#x27;%&#x27; + theVar.toUpperCase() + &#x27;%&#x27;, replacements[theVar]);
    }
  }
  return templateHTML;
}
/**
 *
 * Filename Handling
 *
 */
PKUTIL.export ( &quot;PKUTIL.FILE&quot; );
PKUTIL.FILE = PKUTIL.FILE ||
{
};
PKUTIL.FILE.invalidCharacters = &quot;/,\\,:,|,&lt;,&gt;,*,?,;,%&quot;.split(&quot;,&quot;);
PKUTIL.FILE.extensionSeparator = &quot;.&quot;;
PKUTIL.FILE.pathSeparator = &quot;/&quot;;

PKUTIL.FILE.convertToValidFileName = function(theFileName)
{
  var theNewFileName = theFileName;
  for (var i = 0; i &lt; PKUTIL.FILE.invalidCharacters.length; i++)
  {
    var d = 0;
    while (theNewFileName.indexOf(PKUTIL.FILE.invalidCharacters[i]) &gt; -1 &amp;&amp; (d++) &lt; 50)
    {
      theNewFileName = theNewFileName.replace(PKUTIL.FILE.invalidCharacters[i], &quot;-&quot;);
    }
  }
  return theNewFileName;
}

PKUTIL.FILE.getFilePart = function(theFileName)
{
  var theSlashPosition = theFileName.lastIndexOf(PKUTIL.FILE.pathSeparator);
  if (theSlashPosition &lt; 0)
  {
    return theFileName;
  }
  return theFileName.substr(theSlashPosition + 1, theFileName.length - theSlashPosition);
}

PKUTIL.FILE.getPathPart = function(theFileName)
{
  var theSlashPosition = theFileName.lastIndexOf(PKUTIL.FILE.pathSeparator);
  if (theSlashPosition &lt; 0)
  {
    return &quot;&quot;;
  }
  return theFileName.substr(0, theSlashPosition + 1);
}

PKUTIL.FILE.getFileNamePart = function(theFileName)
{
  var theFileNameNoPath = PKUTIL.FILE.getFilePart(theFileName);
  var theDotPosition = theFileNameNoPath.lastIndexOf(PKUTIL.FILE.extensionSeparator);
  if (theDotPosition &lt; 0)
  {
    return theFileNameNoPath;
  }
  return theFileNameNoPath.substr(0, theDotPosition);
}

PKUTIL.FILE.getFileExtensionPart = function(theFileName)
{
  var theFileNameNoPath = PKUTIL.FILE.getFilePart(theFileName);
  var theDotPosition = theFileNameNoPath.lastIndexOf(PKUTIL.FILE.extensionSeparator);
  if (theDotPosition &lt; 0)
  {
    return &quot;&quot;;
  }
  return theFileNameNoPath.substr(theDotPosition + 1, theFileNameNoPath.length - theDotPosition - 1);
}

// sometimes one needs a psuedo-guid:
// see http://stackoverflow.com/a/8809472
PKUTIL.getGUID = function() {
    var d = new Date().getTime();
    var uuid = &#x27;xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx&#x27;.replace(/[xy]/g, function(c) {
        var r = (d + Math.random()*16)%16 | 0;
        d = Math.floor(d/16);
        return (c==&#x27;x&#x27; ? r : (r&amp;0x7|0x8)).toString(16);
    });
    return uuid;
}

PKUTIL.getUnixTime = function ()
{
  return (new Date()).getTime();
}




    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
